<!DOCTYPE html>
<html>
<head>
  <title>Cytoscape Hover Tooltip Fix</title>
  <style>
    #cy {
      width: 600px;
      height: 600px;
      border: 1px solid #ccc;
      display: block;
    }
    .tooltip {
      background: #fff;
      border: 1px solid #333;
      padding: 5px 8px;
      font-size: 12px;
      position: absolute;
      z-index: 10;
      pointer-events: none;
      display: none;
      white-space: nowrap;
      border-radius: 4px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
  </style>
  <script src="https://unpkg.com/cytoscape@3.25.0/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://unpkg.com/cytoscape-popper@1.0.7/cytoscape-popper.min.js"></script>
</head>
<body>

<div id="cy"></div>
<div id="tooltip" class="tooltip"></div>

<script>
  var cy = cytoscape({
    container: document.getElementById('cy'),

    elements: [
      { data: { id: 'a', name: 'Node A' }, position: { x: 100, y: 100 } },
      { data: { id: 'b', name: 'Node B' }, position: { x: 300, y: 100 } },
      { data: { id: 'c', name: 'Node C' }, position: { x: 200, y: 300 } },
      { data: { id: 'ab', source: 'a', target: 'b' } },
      { data: { id: 'bc', source: 'b', target: 'c' } },
      { data: { id: 'ca', source: 'c', target: 'a' } }
    ],

    style: [
      {
        selector: 'node',
        style: {
          'background-color': '#0074D9',
          'label': 'data(id)',
          'text-valign': 'center',
          'color': '#fff',
          'text-outline-width': 2,
          'text-outline-color': '#0074D9',
          'width': 40,
          'height': 40,
          'font-size': 14,
        }
      },
      {
        selector: 'edge',
        style: {
          'width': 2,
          'line-color': '#ccc'
        }
      }
    ],

    layout: {
      name: 'preset' // use given positions
    }
  });

  var tooltip = document.getElementById('tooltip');
  var popperRef = null;
  var popperInstance = null;

  cy.nodes().forEach(function(node) {
    node.on('mouseover', function(event) {
      tooltip.style.display = 'block';
      tooltip.innerHTML = 'Name: ' + node.data('name');

      if (popperInstance) {
        popperInstance.destroy();
        popperInstance = null;
      }

      popperRef = node.popperRef(); // used by popper.js to position tooltip
      popperInstance = Popper.createPopper(popperRef, tooltip, {
        placement: 'top',
        modifiers: [
          {
            name: 'offset',
            options: {
              offset: [0, 8],
            },
          },
        ],
      });
    });

    node.on('mouseout', function(event) {
      tooltip.style.display = 'none';
      if (popperInstance) {
        popperInstance.destroy();
        popperInstance = null;
      }
    });
  });
</script>

</body>
</html>
